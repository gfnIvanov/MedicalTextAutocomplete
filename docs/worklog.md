# Описание процесса работы над проектом

## Задача

Создание модели, которая должна стать основой инструмента автоматического дополнения текстов медицинской тематики. Модель должна быть легковесной, а реализация способа использования модели должна подразумевать разумное время получения ответа от модели.

Пользователь вводит текст, этот текст подается в обученную модель, которая выдает возможные варианты продолжения данного предложения (в виде слов или словосочетаний), пользователь получает варианты для дальнейшего ввода в веб-интерфейсе и использет их нажимая, например, горячие клавиши.

ВАЖНО: вводимые пользователем данные должны деперсонифицироваться и передаваться на дообучение модели.

## Архитектура решения

В основе решения сервис подготовки данных и обучения модели. Учитывая, что обучение модели может быть достаточно ресурсоемким процессом, должна быть обеспечена возможность как локального обучения, так и быстрого развертывания сервиса обучения в виде микросервиса на внешних ресурсах (предполагается Yandex DataSphere).

Для непосредственного использования модели предполагается использование сервера на Flask и веб-части (для демонстрации возможностей) на Vue3.

## Выбор модели, на базе которой будет обучаться профильная модель

Очевидно, что для задачи распознавания и дополнения текста нам следует использовать модель, основанную либо на архитектуре GTP, либо на архитекутуре BERT.

Посмотрим как работают с автодополнением модели, предварительно обученные на медицинских текстах (как русскоязычных в случае с [RuBioRoBERTa](https://huggingface.co/alexyalunin/RuBioRoBERTa), так и иностранных в случае с [microsoft/biogpt](https://huggingface.co/microsoft/biogpt)) и как работает модель [Mistral-7B-v0.1](https://huggingface.co/mistralai/Mistral-7B-v0.1?text=My+name+is+Teven+and+I+am) в чистом виде до обучения. Попробуем оценить точность этих моделей.

## Данные

Для дообучения модели, задача которой дополнять текст, вводимый врачом с клавиатуры, как нельзя лучше подойдут тексты, которые уже были введены врачами. Это позволит сохранить стиль заполнения медицинской документации, определить частые паттерны, использующиеся при написании заключений и анамнезов, снизит уровень формализма, который присущ профессиональной медицинской литературе (т.е. сделает текст более "человечным"). Однако, необходимо учитывать, что с доступом к реальным врачебным протоколам могут быть проблемы, связанные с защитой персональных данных. Кроме того, для обучения модели профессиональной медицинской терминологии могут служить также упомянутая профессиональная литература, а также официальные документы в сфере здравоохранения и медицинские справочники.

Подключаем dvc для построения пайплайна, добавляем в отслеживание файлы с источниками данных и правилами очистки. Если при запросе данных справочника (справочников) соответствующие данные уже есть в БД в зависимости от наличия флага force либо уведомляем пользователя и прекращаем обновление, либо очищаем данные и запрашиваем их повторно.

Для дообучения используем:

- [Справочники НСИ](https://nsi.rosminzdrav.ru/dictionaries). Справочники отбираем вручную, стараемся не брать узкопрофильные, а выбирать наиболее общие, содержащие по возможности универсально используемые словосочетания (например справочник МКБ10 или номенклатура медицинских услуг). Мысль: подсказки в формате справочников НСИ могут помочь привести оформление медицинской документации к большему единообразию, ну а что, ну а вдруг.
- [Клинические рекомендации и методические руководства](https://cr.minzdrav.gov.ru/clin_recomend). Методические руководства только в PDF. Работаем с клинреками. Клинреки не отбираем, берем все, что доступны. Страница клинрека собирается динамически при помощи Vue, поэтому для парсинга потребовалось подключить [Selenium](https://www.selenium.dev/).
- Стандарты оказания медицинской помощи

## Очистка данных

Данные справочников НСИ достаточно чистые сами по себе, однако содержат сложносоставные наименования химических реагентов, расходных материалов и медицинских услуг, например:

- 3-Метил-2-(1-метил-1Н-пирроло[2,3-b]пиридин-3-карбоксамидо)бутановая кислота и ее производные
- Молекулярно-биологическое исследование мазков со слизистой оболочки носоглотки на коронавирусы 229E, OC43, NL63, HKUI (Human Coronavirus)
- Haemophilus influenzae [H.influenzae] как причина болезней, классифицированных в других рубриках

Можно ограничиться удалением лишних пробелов, приведением к нижнему регистру и удалению знаков препинания. Если наличие таких данных будет негативно сказываться на качестве обучения, пробовать другие методы очистки (при этом в БД необходимо предусмотреть механизм версионирования таких очисток).

